var pntId,acPass,accountStatus,incomeperS,ver=5,autologin=0;function nav(t){switch($(".statusx").text(""),t){case 1:getfundsdata(),medata(pntId),$(".bi-house-door").css("color","rgb(25, 135, 84)"),$(".bi-envelope").css("color","rgb(27,29,29)"),$(".bi-inboxes").css("color","rgb(27,29,29)"),$(".bi-person-circle").css("color","rgb(27,29,29)"),$("#home").css("display","block"),$("#inbox").css("display","none"),$("#transactions").css("display","none"),$("#account").css("display","none");break;case 2:accountStatus&&inbox(pntId,0),$(".bi-house-door").css("color","rgb(27,29,29)"),$(".bi-envelope").css("color","rgb(25, 135, 84)"),$(".bi-inboxes").css("color","rgb(27,29,29)"),$(".bi-person-circle").css("color","rgb(27,29,29)"),$("#home").css("display","none"),$("#inbox").css("display","block"),$("#transactions").css("display","none"),$("#account").css("display","none");break;case 3:accountStatus&&transaction(),$(".bi-house-door").css("color","rgb(27,29,29)"),$(".bi-envelope").css("color","rgb(27,29,29)"),$(".bi-inboxes").css("color","rgb(25, 135, 84)"),$(".bi-person-circle").css("color","rgb(27,29,29)"),$("#home").css("display","none"),$("#inbox").css("display","none"),$("#transactions").css("display","block"),$("#account").css("display","none");break;case 4:medata(pntId),$(".bi-house-door").css("color","rgb(27,29,29)"),$(".bi-envelope").css("color","rgb(27,29,29)"),$(".bi-inboxes").css("color","rgb(27,29,29)"),$(".bi-person-circle").css("color","rgb(25, 135, 84)"),$("#home").css("display","none"),$("#inbox").css("display","none"),$("#transactions").css("display","none"),$("#account").css("display","block")}}function adminnav(t){switch($(".statusx").text(""),t){case 1:$(".bi-person-plus-fill").css("color","rgb(25, 135, 84)"),$(".bi-activity").css("color","rgb(27,29,29)"),$(".bi-stopwatch").css("color","rgb(27,29,29)"),$(".bi-person-circle").css("color","rgb(27,29,29)"),$("#register").css("display","block"),$("#activate").css("display","none"),$("#lend").css("display","none"),$("#client").css("display","none");break;case 2:$(".bi-person-plus-fill").css("color","rgb(27,29,29)"),$(".bi-activity").css("color","rgb(25, 135, 84)"),$(".bi-stopwatch").css("color","rgb(27,29,29)"),$(".bi-person-circle").css("color","rgb(27,29,29)"),$("#register").css("display","none"),$("#activate").css("display","block"),$("#lend").css("display","none"),$("#client").css("display","none"),getmembers();break;case 3:$(".bi-person-plus-fill").css("color","rgb(27,29,29)"),$(".bi-activity").css("color","rgb(27,29,29)"),$(".bi-stopwatch").css("color","rgb(25, 135, 84)"),$(".bi-person-circle").css("color","rgb(27,29,29)"),$("#register").css("display","none"),$("#activate").css("display","none"),$("#lend").css("display","block"),$("#client").css("display","none"),inbox(1,100);break;case 4:$(".bi-person-plus-fill").css("color","rgb(27,29,29)"),$(".bi-activity").css("color","rgb(27,29,29)"),$(".bi-stopwatch").css("color","rgb(27,29,29)"),$(".bi-person-circle").css("color","rgb(25, 135, 84)"),$("#register").css("display","none"),$("#activate").css("display","none"),$("#lend").css("display","none"),$("#client").css("display","block"),lout()}}function alertx(t){$(".statusx").text(t)}function auto(){localStorage.getItem("ver")&&localStorage.getItem("ver")==ver?localStorage.getItem("au")||localStorage.getItem("ap")?0==autologin&&(autologin=1,$("#mobilenumber2").val(localStorage.getItem("au")),$("#password2").val(localStorage.getItem("ap")),$("#loginForm").submit()):(autologin=0,$("#login").css("display","block")):(localStorage.clear(),$("#login").css("display","block"))}function getfundsdata(){$.ajax({url:"https://iptv.givethanksgrocers.com/getfunds-api.php",type:"GET",dataType:"json",success:function(t){"success"===t.status&&(cf=parseInt(t.funds[0].currentfunds),da=cf-parseInt(t.funds[0].outfunds),di1=parseInt(t.funds[0].infunds)/parseInt(t.funds[0].totalshare),di1?(di=di1,de=parseInt(t.funds[0].currentprice)):(di=0,de=parseInt(t.funds[0].currentprice)),$("#dcurrentfunds").text("₱ "+cf),$("#davailable").text("₱ "+da),$("#dentry").text("Entry : ₱ "+Math.floor(de)),incomeperS=Math.floor(di))},error:function(t,s,e){}})}function getmembers(){$.ajax({url:"https://iptv.givethanksgrocers.com/getmembers-api.php",type:"GET",dataType:"json",success:function(t){if("success"===t.status){const s=$("#amember");s.empty(),$.each(t.shares,(function(t,e){const a=$("<tr>");a.html(`\n                        <td class="tfullname" style="width: 160px;">${e.fullname}</td>\n                        <td class="text-center"><input class="form-control-sm" id="${e.user_id}" type="number" min="0" max="100" value="${e.amount}" style="width: 50px;" readonly=""/></td>\n                        <td class="text-center"><button class="btn btn-primary" onclick="activateM(${e.user_id})" id="applyButton${e.user_id}" type="button" style="display: none;">Apply</button><button class="btn btn-danger editButton" onclick="editM(${e.user_id})" id="editButton${e.user_id}" type="button">Edit</button></td>                           \n                    `),s.append(a)}))}else console.error(t.message)},error:function(t,s,e){console.error("Error:",e)}})}function postSharesData(t){$.ajax({url:"https://iptv.givethanksgrocers.com/setshares-api.php",type:"POST",contentType:"application/json",data:JSON.stringify(t),success:function(t){alertx(t.message)},error:function(t,s,e){alertx("Error: "+t.responseText)}})}function activateM(t){$("#editButton"+t).css("display","block"),$("#applyButton"+t).css("display","none"),$(".editButton").prop("disabled",!1),$("#"+t).prop("readonly",!0),$(".statusx").text("Activating..."),av=parseInt($("#"+t).val()),ac=1e3*av;postSharesData({amount:av,credit:ac,payment:0,user_id:t})}function editM(t){$("#editButton"+t).css("display","none"),$("#applyButton"+t).css("display","block"),$("#"+t).prop("readonly",!1),$(".editButton").prop("disabled",!0)}function inbox(t,s){var e="https://iptv.givethanksgrocers.com/inbox-api.php?receiver_id="+t+"&is_read="+s;$.ajax({url:e,type:"GET",dataType:"json",success:function(t){$(".welcome").css("display","none"),$(".inboxMessages").empty(),t.length>0?$.each(t,(function(t,s){switch(s.is_read){case 0:Capmsg="Message",Capamt="",cstyl="display: none;";break;case 100:Capmsg="Request",Capamt="Amount: ",cstyl="display: block;"}var e='<div class="card inboxMsg" style="margin-top: 10px;background: rgba(27,29,29,0.85);display: block;">';e+='<div class="card-header"><svg class="bi bi-star-fill text-warning float-end" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16">',e+='<path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"></path>',e+="</svg>",e+='<h6 class="text-nowrap text-truncate text-light float-start mb-0">'+Capmsg+": </h6>",e+="</div>",e+='<div class="card-body" style="margin-top: 10px;">',e+='<p class="text-light message">'+Capamt+'<span class="sender">'+s.message_text+"</p>",e+='<p class="text-light">Sender: <span class="sender">'+s.sender_name+"</span></p>",e+='<p class="text-light">'+s.timestamp+"</p>",e+='<button class="btn btn-danger" style="'+cstyl+'" onclick="confReq('+s.message_id+","+acPass+')" type="button">Confirm</button>',e+="</div>",e+="</div>",$(".inboxMessages").append(e)})):$(".inboxMessages").html("<p>No messages found for this receiver.</p>")},error:function(t,s,e){$(".inboxMessages").html("<p>Error fetching inbox messages: "+e+"</p>")}})}function transaction(){$.ajax({url:"https://iptv.givethanksgrocers.com/transaction-api.php",type:"GET",dataType:"json",success:function(t){$(".welcome").css("display","none"),$("#transhist").empty(),t.length>0?$.each(t,(function(t,s){s.amount>1e3?ent="Amount :"+s.amount:ent="Entry :"+s.amount;var e='<div class="card inboxMsg" style="margin-top: 10px;background: rgba(27,29,29,0.85);display: block;">';e+='<div class="card-header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16" class="bi bi-clock-history text-warning float-end">',e+='<path d="M8.515 1.019A7 7 0 0 0 8 1V0a8 8 0 0 1 .589.022l-.074.997zm2.004.45a7.003 7.003 0 0 0-.985-.299l.219-.976c.383.086.76.2 1.126.342l-.36.933zm1.37.71a7.01 7.01 0 0 0-.439-.27l.493-.87a8.025 8.025 0 0 1 .979.654l-.615.789a6.996 6.996 0 0 0-.418-.302zm1.834 1.79a6.99 6.99 0 0 0-.653-.796l.724-.69c.27.285.52.59.747.91l-.818.576zm.744 1.352a7.08 7.08 0 0 0-.214-.468l.893-.45a7.976 7.976 0 0 1 .45 1.088l-.95.313a7.023 7.023 0 0 0-.179-.483zm.53 2.507a6.991 6.991 0 0 0-.1-1.025l.985-.17c.067.386.106.778.116 1.17l-1 .025zm-.131 1.538c.033-.17.06-.339.081-.51l.993.123a7.957 7.957 0 0 1-.23 1.155l-.964-.267c.046-.165.086-.332.12-.501zm-.952 2.379c.184-.29.346-.594.486-.908l.914.405c-.16.36-.345.706-.555 1.038l-.845-.535zm-.964 1.205c.122-.122.239-.248.35-.378l.758.653a8.073 8.073 0 0 1-.401.432l-.707-.707z"></path>',e+='<path d="M8 1a7 7 0 1 0 4.95 11.95l.707.707A8.001 8.001 0 1 1 8 0v1z"></path>',e+='<path d="M7.5 3a.5.5 0 0 1 .5.5v5.21l3.248 1.856a.5.5 0 0 1-.496.868l-3.5-2A.5.5 0 0 1 7 9V3.5a.5.5 0 0 1 .5-.5z"></path>',e+="</svg>",e+='<h6 id="tsender" class="text-nowrap text-truncate text-light float-start mb-0">Transaction:</h6>',e+="</div>",e+='<div class="card-body" style="margin-top: 10px;">',e+='<p class="text-light">Type: '+s.type+"</p>",e+='<p class="text-light">'+s.fullname+"</p>",e+='<p class="text-light">'+s.description+"</p>",e+='<p class="text-light">'+ent+"</p>",e+='<p class="text-light">'+s.transaction_date+"</p>",e+="</div>",e+="</div>",$("#transhist").append(e)})):$("#transhist").html("<p>No transhists found for this receiver.</p>")},error:function(t,s,e){$("#transhist").html("<p>Error fetching inbox transhists: "+e+"</p>")}})}function medata(t){var s="https://iptv.givethanksgrocers.com/me-api.php?user_id="+t;$.ajax({url:s,type:"GET",dataType:"json",success:function(t){t?(as=t.accountstatus,"active"===as&&(accountStatus=1,$("#daccountstatus").text(as),$("#dlimit").text(t.credit-t.payment),$("#drepayment").text(t.payment),$("#djoindate").text(t.share_date_added),$("#dcount").text(t.share_amount),$("#dincome").text("₱ "+t.share_amount*incomeperS),$("#dfullname").text(t.fullname),$("#dmobile").text(t.mobilenumber))):$("#userData").html("No data found for the user")},error:function(t,s,e){$("#userData").html("Error fetching data: "+e)}})}function lout(){localStorage.clear(),location.reload()}let deferredPrompt;$(document).ready((function(){$("#registrationForm").submit((function(t){t.preventDefault();var s=$(this).serialize();$.ajax({type:"POST",url:"https://iptv.givethanksgrocers.com/register-api.php",data:s,dataType:"json",success:function(t){alertx(t.message),$("#registrationForm")[0].reset()},error:function(t,s,e){alertx("Error: "+t.responseText)}})})),$("#loginForm").submit((function(t){t.preventDefault(),autologin||(localStorage.setItem("ver",ver),localStorage.setItem("au",$("#mobilenumber2").val()),localStorage.setItem("ap",$("#password2").val()));var s={mobilenumber:$("#mobilenumber2").val(),password:$("#password2").val()};$.ajax({type:"POST",url:"https://iptv.givethanksgrocers.com/login-api.php",data:s,dataType:"json",success:function(t){"success"===t.status?(alertx(t.message),$("#login").css("display","none"),$("#nav").css("display","block"),$("#logo").css("display","block"),pntId=t.user_data.id,"inactive"===t.user_data.accountstatus?(nav(2),accountStatus=0,$("#dfullname").text(t.user_data.fullname),$("#dmobile").text(t.user_data.mobilenumber),$("#daccountstatus").text(t.user_data.accountstatus),$(".welcome").css("display","flex")):(nav(1),accountStatus=1,medata(pntId))):(localStorage.clear(),alertx(t.message)),"admin"===t.status&&($("#login").css("display","none"),$("#rlogin").css("display","none"),$("#register").css("display","block"),$("#adminnav").css("display","block"))},error:function(t,s,e){alertx("Error: "+t.responseText),localStorage.clear()}})})),$("#ver").text("ver: "+ver),auto()})),window.addEventListener("beforeinstallprompt",(t=>{t.preventDefault(),deferredPrompt=t,document.getElementById("login").style.display="none",document.getElementById("installpannel").style.display="block"})),document.getElementById("installButton").addEventListener("click",(()=>{deferredPrompt.prompt(),deferredPrompt.userChoice.then((t=>{"accepted"===t.outcome?(document.getElementById("installpannel").style.display="none",document.getElementById("login").style.display="block",console.log("User accepted the install prompt")):console.log("User dismissed the install prompt"),deferredPrompt=null}))}));