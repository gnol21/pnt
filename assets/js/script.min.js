var pntId,acPass,accountStatus,incomeperS,delgo,ver=20,server="https://iptv.givethanksgrocers.com",autologin=0,userType=0;function nav(e){switch($(".statusx").text(""),e){case 1:getfundsdata(),$(".bi-house-door").css("color","rgb(25, 135, 84)"),$(".bi-envelope").css("color","rgb(27,29,29)"),$(".bi-inboxes").css("color","rgb(27,29,29)"),$(".bi-person-circle").css("color","rgb(27,29,29)"),$(".bi-tv").css("color","rgb(27,29,29)"),$("#home").css("display","block"),$("#inbox").css("display","none"),$("#transactions").css("display","none"),$("#account").css("display","none"),$("#iptv").css("display","none");break;case 2:accountStatus&&inbox(pntId,0),$(".bi-house-door").css("color","rgb(27,29,29)"),$(".bi-envelope").css("color","rgb(25, 135, 84)"),$(".bi-inboxes").css("color","rgb(27,29,29)"),$(".bi-person-circle").css("color","rgb(27,29,29)"),$(".bi-tv").css("color","rgb(27,29,29)"),$("#home").css("display","none"),$("#inbox").css("display","block"),$("#transactions").css("display","none"),$("#account").css("display","none"),$("#iptv").css("display","none");break;case 3:accountStatus&&transaction(),$(".bi-house-door").css("color","rgb(27,29,29)"),$(".bi-envelope").css("color","rgb(27,29,29)"),$(".bi-inboxes").css("color","rgb(25, 135, 84)"),$(".bi-person-circle").css("color","rgb(27,29,29)"),$(".bi-tv").css("color","rgb(27,29,29)"),$("#home").css("display","none"),$("#inbox").css("display","none"),$("#transactions").css("display","block"),$("#account").css("display","none"),$("#iptv").css("display","none");break;case 4:medata(pntId),$(".bi-house-door").css("color","rgb(27,29,29)"),$(".bi-envelope").css("color","rgb(27,29,29)"),$(".bi-inboxes").css("color","rgb(27,29,29)"),$(".bi-person-circle").css("color","rgb(25, 135, 84)"),$(".bi-tv").css("color","rgb(27,29,29)"),$("#home").css("display","none"),$("#inbox").css("display","none"),$("#transactions").css("display","none"),$("#account").css("display","block"),$("#iptv").css("display","none");break;case 5:$(".bi-house-door").css("color","rgb(27,29,29)"),$(".bi-envelope").css("color","rgb(27,29,29)"),$(".bi-inboxes").css("color","rgb(27,29,29)"),$(".bi-person-circle").css("color","rgb(27,29,29)"),$(".bi-tv").css("color","rgb(25, 135, 84)"),$("#home").css("display","none"),$("#inbox").css("display","none"),$("#transactions").css("display","none"),$("#account").css("display","none"),$("#iptv").css("display","block")}}function adminnav(e){switch($(".statusx").text(""),e){case 1:$(".bi-person-plus-fill").css("color","rgb(25, 135, 84)"),$(".bi-activity").css("color","rgb(27,29,29)"),$(".bi-stopwatch").css("color","rgb(27,29,29)"),$(".bi-clipboard-check").css("color","rgb(27,29,29)"),$(".bi-person-circle").css("color","rgb(27,29,29)"),$("#register").css("display","block"),$("#activate").css("display","none"),$("#lend").css("display","none"),$("#payments").css("display","none"),$("#client").css("display","none");break;case 2:$(".bi-person-plus-fill").css("color","rgb(27,29,29)"),$(".bi-activity").css("color","rgb(25, 135, 84)"),$(".bi-stopwatch").css("color","rgb(27,29,29)"),$(".bi-clipboard-check").css("color","rgb(27,29,29)"),$(".bi-person-circle").css("color","rgb(27,29,29)"),$("#register").css("display","none"),$("#activate").css("display","block"),$("#lend").css("display","none"),$("#payments").css("display","none"),$("#client").css("display","none"),getmembers();break;case 3:$(".bi-person-plus-fill").css("color","rgb(27,29,29)"),$(".bi-activity").css("color","rgb(27,29,29)"),$(".bi-stopwatch").css("color","rgb(25, 135, 84)"),$(".bi-clipboard-check").css("color","rgb(27,29,29)"),$(".bi-person-circle").css("color","rgb(27,29,29)"),$("#register").css("display","none"),$("#activate").css("display","none"),$("#lend").css("display","block"),$("#payments").css("display","none"),$("#client").css("display","none"),inbox(pntId,100);break;case 4:$(".bi-person-plus-fill").css("color","rgb(27,29,29)"),$(".bi-activity").css("color","rgb(27,29,29)"),$(".bi-stopwatch").css("color","rgb(27,29,29)"),$(".bi-clipboard-check").css("color","rgb(27,29,29)"),$(".bi-person-circle").css("color","rgb(25, 135, 84)"),$("#register").css("display","none"),$("#activate").css("display","none"),$("#lend").css("display","none"),$("#payments").css("display","none"),$("#client").css("display","block"),lout();break;case 5:$(".bi-person-plus-fill").css("color","rgb(27,29,29)"),$(".bi-activity").css("color","rgb(27,29,29)"),$(".bi-stopwatch").css("color","rgb(27,29,29)"),$(".bi-person-circle").css("color","rgb(27,29,29)"),$(".bi-clipboard-check").css("color","rgb(25, 135, 84)"),$("#register").css("display","none"),$("#activate").css("display","none"),$("#lend").css("display","none"),$("#client").css("display","none"),$("#payments").css("display","block"),inbox(pntId,3)}}function alertx(e){$(".statusx").text(e)}function auto(){localStorage.getItem("ver")&&localStorage.getItem("ver")==ver?localStorage.getItem("au")||localStorage.getItem("ap")?0==autologin&&(autologin=1,$("#mobilenumber2").val(localStorage.getItem("au")),$("#password2").val(localStorage.getItem("ap")),localStorage.clear(),$("#loginForm").submit()):(autologin=0,$("#login").css("display","block")):(localStorage.clear(),$("#login").css("display","block"))}function getfundsdata(){$.ajax({url:server+"/getfunds-api.php",type:"GET",dataType:"json",success:function(e){"success"===e.status&&(cf=parseInt(e.funds[0].currentfunds),da=cf-parseInt(e.funds[0].outfunds),de=parseInt(e.funds[0].currentprice),di1=parseInt(e.funds[0].infunds)/parseInt(e.funds[0].totalshare),di1?di=di1:di=0,$("#dcurrentfunds").text("₱ "+cf),$("#davailable").text("₱ "+da),$("#dentry").text("Entry : ₱ "+Math.floor(de)),incomeperS=Math.floor(di),medata(pntId))},error:function(e,s,t){}})}function getmembers(){$.ajax({url:server+"/getmembers-api.php",type:"GET",dataType:"json",success:function(e){if("success"===e.status){const s=$("#amember");s.empty(),$.each(e.shares,(function(e,t){const a=$("<tr>");a.html(`\n                        <td class="tfullname" style="width: 160px;">${t.fullname}</td>\n                        <td class="text-center"><input class="form-control-sm" id="${t.user_id}" type="number" min="0" max="100" value="${t.amount}" style="width: 50px;" readonly=""/></td>\n                        <td class="text-center"><button class="btn btn-primary" onclick="activateM(${t.user_id})" id="applyButton${t.user_id}" type="button" style="display: none;">Apply</button><button class="btn btn-danger editButton" onclick="editM(${t.user_id})" id="editButton${t.user_id}" type="button">Edit</button></td><td class="text-center"><button class="btn btn-warning" onclick="delM(${t.user_id})" id="delButton${t.user_id}" type="button" style="display:none;">Del</button></td>\n                        \n                        \n                    `),s.append(a)}))}else console.error(e.message)},error:function(e,s,t){console.error("Error:",t)}})}function postSharesData(e,s){const t=server+s;$.ajax({url:t,type:"POST",contentType:"application/json",data:JSON.stringify(e),success:function(e){alertx(e.message),adminnav(2)},error:function(e,s,t){alertx("Error: "+e.responseText)}})}function activateM(e){$("#editButton"+e).css("display","block"),$("#applyButton"+e).css("display","none"),$(".editButton").prop("disabled",!1),$("#"+e).prop("readonly",!0),$(".statusx").text("Activating..."),av=parseInt($("#"+e).val()),ac=1e3*av;postSharesData({amount:av,credit:ac,payment:0,user_id:e},"/setshares-api.php")}function editM(e){$("#editButton"+e).css("display","none"),$("#applyButton"+e).css("display","block"),$("#delButton"+e).css("display","block"),$("#"+e).prop("readonly",!1),$(".editButton").prop("disabled",!0)}function delM(e){delgo=e,$("#alertx").modal("show")}function delgom(e){postSharesData({user_id:e},"/delshares-api.php")}function sendmsg(e,s,t){var a={sender_name:localStorage.getItem("fullname"),sender_id:pntId,receiver_id:e,message_text:s,is_read:t,password:localStorage.getItem("ap")};$.post(server+"/sendmsg-api.php",a).done((function(e){dt=JSON.parse(e),"success"===dt.status&&(requestStatus(t),$(".modal-body > p.text-center").text(dt.message),$("#Rsend").prop("disabled",!0).addClass("disabled"),$("#Ramount").val(""),$(".Rhide").css("display","none"),$(".Rshow").css("display","block"),1===userType&&adminnav(3))})).fail((function(e){console.error(e)}))}$(document).ready((function(){$("#registrationForm").submit((function(e){e.preventDefault();var s=$(this).serialize();$.ajax({type:"POST",url:server+"/register-api.php",data:s,dataType:"json",success:function(e){alertx(e.message),$("#registrationForm")[0].reset()},error:function(e,s,t){alertx("Error: "+e.responseText)}})})),$("#loginForm").submit((function(e){e.preventDefault(),localStorage.setItem("ver",ver),localStorage.setItem("au",$("#mobilenumber2").val()),localStorage.setItem("ap",$("#password2").val());var s={mobilenumber:$("#mobilenumber2").val(),password:$("#password2").val()};$.ajax({type:"POST",url:server+"/login-api.php",data:s,dataType:"json",success:function(e){switch(e.status){case"success":alertx(e.message),$("#login").css("display","none"),$("#nav").css("display","block"),$("#logo").css("display","block"),pntId=e.user_data.id,"inactive"===e.user_data.accountstatus?(nav(2),accountStatus=0,$("#dfullname").text(e.user_data.fullname),$("#dmobile").text(e.user_data.mobilenumber),$("#daccountstatus").text(e.user_data.accountstatus),$(".welcome").css("display","flex")):(nav(1),accountStatus=1);break;case"admin":pntId=e.user_data.id,$("#login").css("display","none"),$("#rlogin").css("display","none"),$("#register").css("display","block"),$("#adminnav").css("display","block"),userType=1;break;default:localStorage.clear(),alertx(e.message)}},error:function(e,s,t){alertx("Error: "+e.responseText),localStorage.clear()}})})),$("#Ramount").on("input",(function(){$(this).val($(this).val().replace(/[^0-9]/g,""));var e=parseInt($(this).val()),s=parseFloat(localStorage.getItem("limit"));$(this).attr("max",s),!isNaN(e)&&e>=500&&e<=s?($("#Rsend").prop("disabled",!1).removeClass("disabled"),$(".modal-body > p.text-center").text("You can proceed with the request.")):isNaN(e)||e<500?($("#Rsend").prop("disabled",!0).addClass("disabled"),$(".modal-body > p.text-center").text("The amount must be at least 500.")):($("#Rsend").prop("disabled",!0).addClass("disabled"),$(".modal-body > p.text-center").text("The amount exceeds the credit limit."))})),$("#ver").text("ver: "+ver),auto()}));var Rid=0;function requestStatus(e){var s=server+"/request-check.php?sender_id="+pntId+"&is_read="+e;$.ajax({url:s,type:"GET",dataType:"json",success:function(s){if("error"===s.status)switch(e){case 100:$(".Rhide").css("display","block"),$(".Rshow").css("display","none"),$(".modal-body > p.text-center").text("Server Connected"),$("#Ramount").prop("disabled",!1).removeClass("disabled");break;case 3:requestRepayment(),$(".modal-body > p.text-center").text("Billing Details"),$("#Psend").css("display","block"),$("#Pcancel").css("display","none")}else if(s[0].message_id)switch(Rid=s[0].message_id,e){case 100:$(".modal-body > p.text-center").text("Pending Request"),$("#Rcancel").prop("disabled",!1).removeClass("disabled"),$(".Rhide").css("display","none"),$("#Rname").text(s[0].sender_name),$("#drequest").text(s[0].message_text),$("#Rtime").text(s[0].timestamp);break;case 3:requestRepayment(),$(".modal-body > p.text-center").text("Waiting for Payment"),$("#Pcancel").css("display","block"),$("#Psend").css("display","none")}},error:function(e,s,t){console.error(e.responseText)}})}function inbox(e,s){var t=server+"/inbox-api.php?receiver_id="+e+"&is_read="+s;$.ajax({url:t,type:"GET",dataType:"json",success:function(e){$(".welcome").css("display","none"),$(".inboxMessages").empty(),e.length>0?$.each(e,(function(e,s){switch(s.is_read){case 0:Capmsg="Message",Capamt="",cstyl="display: none;",cstyl2="display: none;";break;case 100:Capmsg="Request",Capamt="Amount: ",cstyl2="display: none;",cstyl="display: block;";break;case 3:Capmsg="To Pay",Capamt="Amount: ",cstyl="display: none;",cstyl2="display: block;"}var t='<div class="card inboxMsg" style="margin-top: 10px;background: rgba(27,29,29,0.85);display: block;">';t+='<div class="card-header"><svg class="bi bi-star-fill text-warning float-end" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16">',t+='<path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"></path>',t+="</svg>",t+='<h6 class="text-nowrap text-truncate text-light mb-0">'+Capmsg+": </h6>",t+="</div>",t+='<div class="card-body" style="margin-top: 10px;">',t+='<p class="text-light message">'+Capamt+'<span class="sender">'+s.message_text+"</p>",t+='<p class="text-light">Sender: <span class="sender">'+s.sender_name+"</span></p>",t+='<p class="text-light">'+s.timestamp+"</p>",t+='<button class="btn btn-danger" style="'+cstyl+'" onclick="confReq('+s.message_id+',1)" type="button">Confirm</button>',t+='<button class="btn btn-danger" style="'+cstyl2+'" onclick="confReq('+s.message_id+',2)" type="button">Mark as Paid</button>',t+="</div>",t+="</div>",$(".inboxMessages").append(t)})):$(".welcome").css("display","block")},error:function(e,s,t){$(".inboxMessages").html("<p>Error fetching inbox messages: "+t+"</p>")}})}function delInbox(e){var s=e;$.ajax({url:server+"/deleteinbox-api.php",method:"POST",dataType:"json",data:{message_id:s},success:function(e){"success"===e.status&&($(".modal-body > p.text-center").text("Server Conneted"),$("#Ramount").prop("disabled",!1).removeClass("disabled"),$(".Rhide").css("display","block"),$(".Rshow").css("display","none"))},error:function(e,s,t){console.error(e.responseText),$(".modal-body > p.text-center").text("Error: Failed to Cancel.")}})}function transaction(){var e=server+"/transaction-api.php";$.ajax({url:e,type:"GET",dataType:"json",success:function(e){$(".welcome").css("display","none"),$("#transhist").empty(),e.length>0?$.each(e,(function(e,s){s.amount>1e3?ent="Amount :"+s.amount:ent="Entry :"+s.amount;var t='<div class="card inboxMsg" style="margin-top: 10px;background: rgba(27,29,29,0.85);display: block;">';t+='<div class="card-header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16" class="bi bi-clock-history text-warning float-end">',t+='<path d="M8.515 1.019A7 7 0 0 0 8 1V0a8 8 0 0 1 .589.022l-.074.997zm2.004.45a7.003 7.003 0 0 0-.985-.299l.219-.976c.383.086.76.2 1.126.342l-.36.933zm1.37.71a7.01 7.01 0 0 0-.439-.27l.493-.87a8.025 8.025 0 0 1 .979.654l-.615.789a6.996 6.996 0 0 0-.418-.302zm1.834 1.79a6.99 6.99 0 0 0-.653-.796l.724-.69c.27.285.52.59.747.91l-.818.576zm.744 1.352a7.08 7.08 0 0 0-.214-.468l.893-.45a7.976 7.976 0 0 1 .45 1.088l-.95.313a7.023 7.023 0 0 0-.179-.483zm.53 2.507a6.991 6.991 0 0 0-.1-1.025l.985-.17c.067.386.106.778.116 1.17l-1 .025zm-.131 1.538c.033-.17.06-.339.081-.51l.993.123a7.957 7.957 0 0 1-.23 1.155l-.964-.267c.046-.165.086-.332.12-.501zm-.952 2.379c.184-.29.346-.594.486-.908l.914.405c-.16.36-.345.706-.555 1.038l-.845-.535zm-.964 1.205c.122-.122.239-.248.35-.378l.758.653a8.073 8.073 0 0 1-.401.432l-.707-.707z"></path>',t+='<path d="M8 1a7 7 0 1 0 4.95 11.95l.707.707A8.001 8.001 0 1 1 8 0v1z"></path>',t+='<path d="M7.5 3a.5.5 0 0 1 .5.5v5.21l3.248 1.856a.5.5 0 0 1-.496.868l-3.5-2A.5.5 0 0 1 7 9V3.5a.5.5 0 0 1 .5-.5z"></path>',t+="</svg>",t+='<h6 id="tsender" class="text-nowrap text-truncate text-light mb-0">Transaction:</h6>',t+="</div>",t+='<div class="card-body" style="margin-top: 10px;">',t+='<p class="text-light">Type: '+s.type+"</p>",t+='<p class="text-light">'+s.fullname+"</p>",t+='<p class="text-light">'+s.description+"</p>",t+='<p class="text-light">'+ent+"</p>",t+='<p class="text-light">'+s.transaction_date+"</p>",t+="</div>",t+="</div>",$("#transhist").append(t)})):$("#transhist").html("<p>No transhists found for this receiver.</p>")},error:function(e,s,t){$("#transhist").html("<p>Error fetching inbox transhists: "+t+"</p>")}})}function medata(e){var s=server+"/me-api.php?user_id="+e;$.ajax({url:s,type:"GET",dataType:"json",success:function(e){e?(as=e.accountstatus,"active"===as&&(accountStatus=1,$("#daccountstatus").text(as),$(".dlimit").text("₱ "+(e.credit-e.payment)),$("#drepayment").text("₱ "+e.payment),$("#djoindate").text(e.share_date_added),$("#dcount").text(e.share_amount),$("#dincome").text("₱ "+e.income),$("#dfullname").text(e.fullname),$("#dmobile").text(e.mobilenumber),limit=parseFloat(e.credit)-parseFloat(e.payment),localStorage.setItem("limit",limit),localStorage.setItem("fullname",e.fullname))):$("#userData").html("No data found for the user")},error:function(e,s,t){$("#userData").html("Error fetching data: "+t)}})}function lout(){localStorage.clear(),location.reload()}function confReq(e,s){var t={message_id:e,user_id:localStorage.getItem("au"),user_pass:localStorage.getItem("ap"),type:s};$.ajax({url:server+"/lend-api.php",type:"POST",data:t,dataType:"json",success:function(e){"success"===e.status?adminnav(3):console.log(e.message)},error:function(e,s,t){console.error(e.responseText)}})}function requestRepayment(){pntfullname=localStorage.getItem("fullname");var e=server+"/repayment-check.php?sender_id="+pntfullname;$.ajax({url:e,type:"GET",dataType:"json",success:function(e){"error"===e.status||e[0].fullname===pntfullname&&($("#modal-reypayment").modal("show"),$("#Dname").text(e[0].fullname),$("#Dtrans").text(e[0].transaction_date),$("#Dtime").text(e[0].due_date),$("#Dunpaid").text(e[0].amount),$("#Dinterest").text(e[0].interest),$("#Dtotalamount").text(e[0].amount+e[0].interest))},error:function(e,s,t){console.error(e.responseText)}})}let deferredPrompt;$(".cignalbtn").click((function(){$("#video").css("display","block")})),$("#cignal").on("hidden.bs.modal",(function(){$("#vframe").attr("src","https://gnol21.github.io/cignal")})),window.addEventListener("beforeinstallprompt",(e=>{e.preventDefault(),deferredPrompt=e,document.getElementById("login").style.display="none",document.getElementById("installpannel").style.display="block"})),document.getElementById("installButton").addEventListener("click",(()=>{deferredPrompt.prompt(),deferredPrompt.userChoice.then((e=>{"accepted"===e.outcome?(document.getElementById("installpannel").style.display="none",document.getElementById("login").style.display="block",console.log("User accepted the install prompt")):console.log("User dismissed the install prompt"),deferredPrompt=null}))}));